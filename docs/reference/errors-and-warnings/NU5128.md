---
title: NuGet 警告 NU5128
description: NU5128 警告碼
author: zivkan
ms.date: 09/06/2019
ms.topic: reference
ms.reviewer: karann
f1_keywords:
- NU5128
ms.openlocfilehash: d1ce9fde28eff60b81f464088637572e6ad71a49
ms.sourcegitcommit: e4b0ff4460865db6dc7bc9f20e9f644d98493011
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/26/2019
ms.locfileid: "71307204"
---
# <a name="nuget-warning-nu5128"></a><span data-ttu-id="d32bc-103">NuGet 警告 NU5128</span><span class="sxs-lookup"><span data-stu-id="d32bc-103">NuGet Warning NU5128</span></span>

## <a name="scenario-1"></a><span data-ttu-id="d32bc-104">案例 1</span><span class="sxs-lookup"><span data-stu-id="d32bc-104">Scenario 1</span></span>

<pre>Some target frameworks declared in the dependencies group of the nuspec and the lib/ref folder do not have exact matches in the other location. Consult the list of actions below:
- Add a dependency group for .NETStandard2.0 to the nuspec</pre>

### <a name="issue"></a><span data-ttu-id="d32bc-105">問題</span><span class="sxs-lookup"><span data-stu-id="d32bc-105">Issue</span></span>

<span data-ttu-id="d32bc-106">封裝`lib/<tfm>/`中`ref/<tfm>/`的或目錄至少包含警告訊息中指定之[目標 Framework 標記（TFM）](../target-frameworks.md)的一個檔案。</span><span class="sxs-lookup"><span data-stu-id="d32bc-106">The `lib/<tfm>/` or `ref/<tfm>/` directory in the package contains at least one file for the [Target Framework Moniker (TFM)](../target-frameworks.md) specified in the warning message.</span></span> <span data-ttu-id="d32bc-107">不過，檔案中`nuspec`的這個 TFM 不存在任何相依性群組。</span><span class="sxs-lookup"><span data-stu-id="d32bc-107">However, no dependency group exists for this TFM in the `nuspec` file.</span></span> <span data-ttu-id="d32bc-108">這可能會導致套件取用者認為套件與 TFM 不相容，即使封裝沒有相依性。</span><span class="sxs-lookup"><span data-stu-id="d32bc-108">This may cause package consumers to believe the package is not compatible with the TFM, even if the package does not have dependencies.</span></span> <span data-ttu-id="d32bc-109">如果封裝有未宣告的相依性，使用封裝的專案將會遇到執行階段錯誤。</span><span class="sxs-lookup"><span data-stu-id="d32bc-109">If the package has undeclared dependencies, the project using the package will experience runtime errors.</span></span>

### <a name="solution"></a><span data-ttu-id="d32bc-110">方案</span><span class="sxs-lookup"><span data-stu-id="d32bc-110">Solution</span></span>

* <span data-ttu-id="d32bc-111">在專案上執行 NuGet 的套件目標</span><span class="sxs-lookup"><span data-stu-id="d32bc-111">Run NuGet's pack target on the project</span></span>

<span data-ttu-id="d32bc-112">可能的話，請使用[NuGet 的 MSBuild 套件目標](../msbuild-targets.md)，因為它會自動將元件 tfm 與專案的目標架構中的相依性群組進行比對。</span><span class="sxs-lookup"><span data-stu-id="d32bc-112">If possible, use [NuGet's MSBuild pack target](../msbuild-targets.md), as it automatically matches assembly TFMs with dependency groups from the project's target frameworks.</span></span> <span data-ttu-id="d32bc-113">請注意，您的專案`PackageReference`必須用於自己的 NuGet 相依性。</span><span class="sxs-lookup"><span data-stu-id="d32bc-113">Note that your project must use `PackageReference` for its own NuGet dependencies.</span></span> <span data-ttu-id="d32bc-114">如果您的專案使用了 config.xml，您就必須使用`nuget.exe pack` `nuspec`和檔案。</span><span class="sxs-lookup"><span data-stu-id="d32bc-114">If your project uses packages.config, you need to use `nuget.exe pack` and a `nuspec` file.</span></span>

* <span data-ttu-id="d32bc-115">手動編輯`nuspec`的檔案</span><span class="sxs-lookup"><span data-stu-id="d32bc-115">Manually edited `nuspec` file</span></span>

<span data-ttu-id="d32bc-116">如果您使用自訂`nuspec`檔案，我們建議每個存在`lib/`或`ref/`元件的 TFM 都應該具有相符的相依性群組，即使相依性與下一個相容的 TFM 相同也一樣。</span><span class="sxs-lookup"><span data-stu-id="d32bc-116">If you are using a custom `nuspec` file, we recommend each TFM for which `lib/` or `ref/` assemblies exist should have a matching dependency group, even if the dependencies are the same as the next compatible TFM.</span></span> <span data-ttu-id="d32bc-117">例如，如果封裝包含`netstandard1.0`和`netstandard2.0`元件，而且兩者的相依性都相同，建議您將這兩個 tfm 列為具有重複相依性專案的相依性群組。</span><span class="sxs-lookup"><span data-stu-id="d32bc-117">For example, if a package contains `netstandard1.0` and `netstandard2.0` assemblies, and the dependencies are the same for both, we recommend both TFMs be listed as dependency groups with duplicate dependency items.</span></span>

<span data-ttu-id="d32bc-118">請注意，元件路徑中使用的 TFM 識別碼會使用與相依性群組中所使用的 TFM 識別碼不同的格式。</span><span class="sxs-lookup"><span data-stu-id="d32bc-118">Note that the TFM identifier used in the assembly paths use a different format to the TFM identifier used in dependency groups.</span></span> <span data-ttu-id="d32bc-119">警告訊息會指定要在相依性群組中使用的正確名稱。</span><span class="sxs-lookup"><span data-stu-id="d32bc-119">The warning message specifies the correct name to use in the dependency group.</span></span> <span data-ttu-id="d32bc-120">如果您的封裝沒有該目標 framework 的任何相依性，請使用空的群組。</span><span class="sxs-lookup"><span data-stu-id="d32bc-120">If your package does not have any dependencies for that target framework, use an empty group.</span></span> <span data-ttu-id="d32bc-121">例如：</span><span class="sxs-lookup"><span data-stu-id="d32bc-121">For example:</span></span>

```xml
<package>
  <metadata>
    ...
    <dependencies>
      <group targetFramework=".NETFramework4.7.2" />
    </dependencies>
  </metadata>
  ...
<package>
```

* <span data-ttu-id="d32bc-122">`lib/`移除或檔案`ref/`</span><span class="sxs-lookup"><span data-stu-id="d32bc-122">Remove the `lib/` or `ref/` files</span></span>

<span data-ttu-id="d32bc-123">如果您不想要讓套件與報告的 TFM 相容，請修改您的專案，讓該`lib/<tfm>/` TFM `ref/<tfm>/`的套件中沒有或檔案。</span><span class="sxs-lookup"><span data-stu-id="d32bc-123">If you do not wish your package to be compatible with the reported TFM, modify your project such that no `lib/<tfm>/` or `ref/<tfm>/` files are in the package for that TFM.</span></span> <span data-ttu-id="d32bc-124">例如，如果警告指出要將`.NETFramework4.7.2`的相依性群組加入`nuspec`至，則從封裝中移除`lib/net472/*`任何`ref/net472/*`和檔案。</span><span class="sxs-lookup"><span data-stu-id="d32bc-124">For example, if the warning says to add a dependency group for `.NETFramework4.7.2` to the `nuspec`, then remove any `lib/net472/*` and `ref/net472/*` files from your package.</span></span>

## <a name="scenario-2"></a><span data-ttu-id="d32bc-125">案例 2</span><span class="sxs-lookup"><span data-stu-id="d32bc-125">Scenario 2</span></span>

<pre>Some target frameworks declared in the dependencies group of the nuspec and the lib/ref folder do not have exact matches in the other location. Consult the list of actions below:
- Add lib or ref assemblies for the netstandard2.0 target framework</pre>

### <a name="issue"></a><span data-ttu-id="d32bc-126">問題</span><span class="sxs-lookup"><span data-stu-id="d32bc-126">Issue</span></span>

<span data-ttu-id="d32bc-127">此檔案具有所報告目標 Framework 標記（TFM）的相依性群組，但`lib/`或`ref/`中沒有任何元件存在於此 TFM。 `nuspec`</span><span class="sxs-lookup"><span data-stu-id="d32bc-127">The `nuspec` file has a dependency group for the reported Target Framework Moniker (TFM), but no assemblies exist for this TFM in either `lib/` or `ref/`.</span></span> <span data-ttu-id="d32bc-128">如果有相容 TFM 的元件，封裝仍然會安裝，但相依性對於編譯時期使用的元件而言可能不正確，而且可能會導致專案在執行時間失敗。</span><span class="sxs-lookup"><span data-stu-id="d32bc-128">If there are assemblies for a compatible TFM, the package will still install, but the dependencies might be incorrect for a assemblies used at compile time and could cause the project to fail at runtime.</span></span>

### <a name="solution"></a><span data-ttu-id="d32bc-129">方案</span><span class="sxs-lookup"><span data-stu-id="d32bc-129">Solution</span></span>

* <span data-ttu-id="d32bc-130">在專案上執行 NuGet 的套件目標</span><span class="sxs-lookup"><span data-stu-id="d32bc-130">Run NuGet's pack target on the project</span></span>

<span data-ttu-id="d32bc-131">可能的話，請使用[NuGet 的 MSBuild 套件目標](../msbuild-targets.md)，因為它會自動將元件 tfm 與專案的目標架構中的相依性群組進行比對。</span><span class="sxs-lookup"><span data-stu-id="d32bc-131">If possible, use [NuGet's MSBuild pack target](../msbuild-targets.md), as it automatically matches assembly TFMs with dependency groups from the project's target frameworks.</span></span> <span data-ttu-id="d32bc-132">請注意，您的專案`PackageReference`必須用於自己的 NuGet 相依性。</span><span class="sxs-lookup"><span data-stu-id="d32bc-132">Note that your project must use `PackageReference` for its own NuGet dependencies.</span></span> <span data-ttu-id="d32bc-133">如果您的專案使用了 config.xml，您就必須使用`nuget.exe pack` `nuspec`和檔案。</span><span class="sxs-lookup"><span data-stu-id="d32bc-133">If your project uses packages.config, you need to use `nuget.exe pack` and a `nuspec` file.</span></span>

* <span data-ttu-id="d32bc-134">手動編輯`nuspec`檔案</span><span class="sxs-lookup"><span data-stu-id="d32bc-134">Manually edit the `nuspec` file</span></span>

<span data-ttu-id="d32bc-135">將報告的 TFM 新增為您的專案針對其編譯的其他目標架構，並將元件加入至封裝。</span><span class="sxs-lookup"><span data-stu-id="d32bc-135">Add the reported TFM as an additional Target Framework for which your project compiles for, and add the assemblies to the package.</span></span> <span data-ttu-id="d32bc-136">如果您使用 SDK 樣式專案來多個 tfm 多個目標，NuGet 的 MSBuild 套件目標可以自動將元件新增至正確`lib/<tfm>/`的資料夾，並使用正確的 tfm 和相依性建立相依性群組。</span><span class="sxs-lookup"><span data-stu-id="d32bc-136">If you are using an SDK style project to multi-target multiple TFMs, NuGet's MSBuild pack targets can automatically add assemblies in the correct `lib/<tfm>/` folder and create dependency groups with the correct TFMs and dependencies.</span></span> <span data-ttu-id="d32bc-137">如果您使用非 SDK 樣式專案，您可能需要為其他 TFM 建立額外的專案檔，並修改您`nuspec`的檔案，以便將輸出元件複製到封裝中的正確位置。</span><span class="sxs-lookup"><span data-stu-id="d32bc-137">If you are using a non-SDK style project, you will likely need to create an additional project file for the additional TFM, and modify your `nuspec` file to copy the output assemblies in the correct location in the package.</span></span>

* <span data-ttu-id="d32bc-138">新增空白`_._`檔案</span><span class="sxs-lookup"><span data-stu-id="d32bc-138">Add an empty `_._` file</span></span>

<span data-ttu-id="d32bc-139">如果您的套件未包含任何元件（例如中繼套件），請考慮將空`_._`的檔案新增至警告訊息中所列之 tfm 的`lib/<tfm>/`目錄。</span><span class="sxs-lookup"><span data-stu-id="d32bc-139">If your package does not contain any assemblies, such as a meta-package, consider adding an empty `_._` file to the `lib/<tfm>/` directories for the TFMs listed in the warning message.</span></span> <span data-ttu-id="d32bc-140">例如，如果警告指出要加入`netstandard2.0`目標 framework 的元件，請在您的封裝中建立空`lib/netstandard2.0/_._`的檔案。</span><span class="sxs-lookup"><span data-stu-id="d32bc-140">For example, if the warning says to add assemblies for the `netstandard2.0` target framework, create an empty `lib/netstandard2.0/_._` file in your package.</span></span>

* <span data-ttu-id="d32bc-141">移除相依性群組</span><span class="sxs-lookup"><span data-stu-id="d32bc-141">Remove the dependency group</span></span>

<span data-ttu-id="d32bc-142">如果您使用自訂`nuspec`檔案，請移除所報告 TFM 的相依性群組，只留下 tfm 的相依性群組`lib/<tfm>/` ， `ref/<tfm>/`其中存在或檔案。</span><span class="sxs-lookup"><span data-stu-id="d32bc-142">If you use a custom `nuspec` file, remove the dependency group for the reported TFM, leaving only dependency groups for TFMs for which `lib/<tfm>/` or `ref/<tfm>/` files exist.</span></span>

* <span data-ttu-id="d32bc-143">移除與元件無關之套件的所有相依性</span><span class="sxs-lookup"><span data-stu-id="d32bc-143">Remove all dependencies for packages that are not related to assemblies</span></span>

<span data-ttu-id="d32bc-144">如果您的套件未包含任何`lib/`或`ref/`檔案，而且不是中繼套件，則可能沒有封裝取用者需要的任何相依性。</span><span class="sxs-lookup"><span data-stu-id="d32bc-144">If your package does not contain any `lib/` or `ref/` files and is not a meta-package, it likely does not have any dependencies that the package consumer needs.</span></span> <span data-ttu-id="d32bc-145">如果您使用 NuGet 的 MSBuild Pack 目標進行封裝，您可以在`<SuppressDependenciesWhenPacking>true</SuppressDependenciesWhenPacking>`專案檔`PropertyGroup`的任何中設定。</span><span class="sxs-lookup"><span data-stu-id="d32bc-145">If you are packing with NuGet's MSBuild Pack target, you can set `<SuppressDependenciesWhenPacking>true</SuppressDependenciesWhenPacking>` in any `PropertyGroup` in your project file.</span></span> <span data-ttu-id="d32bc-146">如果您使用自訂`nuspec`檔案，請`<dependencies>`移除元素。</span><span class="sxs-lookup"><span data-stu-id="d32bc-146">If you are using a custom `nuspec` file, remove the `<dependencies>` element.</span></span>

* <span data-ttu-id="d32bc-147">其他案例</span><span class="sxs-lookup"><span data-stu-id="d32bc-147">Other scenarios</span></span>

<span data-ttu-id="d32bc-148">這項警告是在 NuGet 5.3 的開發期間新增，第一種是在 .NET Core SDK 3.0 Preview 9 中提供。</span><span class="sxs-lookup"><span data-stu-id="d32bc-148">This warning was added during NuGet 5.3's development, and first was available in .NET Core SDK 3.0 Preview 9.</span></span> <span data-ttu-id="d32bc-149">[NuGet/Home # 8583](https://github.com/nuget/home/issues/8583)會追蹤在太多案例中引發警告的問題。</span><span class="sxs-lookup"><span data-stu-id="d32bc-149">[NuGet/Home#8583](https://github.com/nuget/home/issues/8583) tracks an issue where the warning was being raised in too many scenarios.</span></span> <span data-ttu-id="d32bc-150">您可以使用 MSBuild `NoWarn`屬性（加入`<NoWarn>$(NoWarn);NU5128</NoWarn>`至專案檔`PropertyGroup`中的任何）。</span><span class="sxs-lookup"><span data-stu-id="d32bc-150">You can use the `NoWarn` MSBuild property (add `<NoWarn>$(NoWarn);NU5128</NoWarn>` to any `PropertyGroup` in your project file).</span></span> <span data-ttu-id="d32bc-151">如果您有多個受影響的專案， [`Directory.Build.targets`](/visualstudio/msbuild/customize-your-build)您可以使用`NoWarn`自動新增至所有專案。</span><span class="sxs-lookup"><span data-stu-id="d32bc-151">If you have multiple projects affected, you can use [`Directory.Build.targets`](/visualstudio/msbuild/customize-your-build) to automatically add `NoWarn` to all projects.</span></span>
